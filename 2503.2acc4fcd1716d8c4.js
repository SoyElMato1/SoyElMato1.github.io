"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2503],{2503:(F,g,d)=>{d.r(g),d.d(g,{CarritoPageModule:()=>P});var u=d(177),a=d(4341),c=d(4742),m=d(6766),p=d(467),h=d(5964),o=d(3953),f=d(9368);function b(i,s){if(1&i){const l=o.RV6();o.j41(0,"li",25)(1,"div")(2,"h6",26),o.EFF(3),o.k0s(),o.j41(4,"small",27),o.EFF(5),o.k0s(),o.j41(6,"span",28),o.EFF(7),o.k0s()(),o.j41(8,"div",29)(9,"div",30)(10,"ion-button",31),o.bIt("click",function(){const t=o.eBV(l).$implicit,n=o.XpG();return o.Njj(n.bajarItem(t.producto_id))}),o.EFF(11,"-"),o.k0s(),o.j41(12,"p"),o.EFF(13),o.k0s(),o.j41(14,"ion-button",31),o.bIt("click",function(){const t=o.eBV(l).$implicit,n=o.XpG();return o.Njj(n.agregarItem(t.producto_id))}),o.EFF(15,"+"),o.k0s()(),o.j41(16,"ion-button",32),o.bIt("click",function(){const t=o.eBV(l).$implicit,n=o.XpG();return o.Njj(n.removeItem(t.producto_id))}),o.nrm(17,"ion-icon",33),o.k0s()()()}if(2&i){const l=s.$implicit,e=o.XpG();o.R7$(3),o.JRh(l.nombre),o.R7$(2),o.SpI("Cantidad: ",l.cantidad," x "),o.R7$(2),o.SpI("$",e.precioUnitario(l.precio,l.cantidad)," CLP"),o.R7$(6),o.SpI(" ",l.cantidad," ")}}function C(i,s){1&i&&(o.j41(0,"div",34)(1,"p"),o.EFF(2,"El carrito est\xe1 vac\xedo"),o.k0s()())}const _=[{path:"",component:(()=>{var i;class s{togglePasswordVisibility(e){"register"===e&&(this.showPasswordRegister=!this.showPasswordRegister)}constructor(e,t,n,r){this.cartService=e,this.toastController=t,this.router=n,this.fb=r,this.cartItems=[],this.total=0,this.customer={rut:"",dv:"",correo_electronico:"",contrasena:"",nombre:"",direccion:""},this.mensaje="",this.showClienteForm=!1,this.showPasswordRegister=!1,this.customerForm=this.fb.group({rut:["",[a.k0.required,a.k0.pattern("^[0-9]+$"),a.k0.minLength(7),a.k0.maxLength(8)]],dv:["",[a.k0.required,a.k0.pattern("^[0-9Kk]{1}$")]],correo_electronico:["",[a.k0.required,a.k0.email]],contrasena:["",[a.k0.required,a.k0.minLength(8),a.k0.maxLength(16),a.k0.pattern(/(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/)]],nombre:["",a.k0.required,a.k0.pattern("^[a-zA-Z\xf1\xd1]+$")],direccion:["",a.k0.required]})}ngOnInit(){this.loadCart(),this.loadCustomerData(),this.router.events.pipe((0,h.p)(e=>e instanceof m.wF)).subscribe(()=>{this.loadCart()})}precioUnitario(e,t){return e*t}loadCart(){this.cartService.ver_carrito().subscribe(e=>{this.carrito=e,this.cartItems=e.items,this.total=Number(e.total),console.log("Carrito cargado:",this.carrito),console.log("Items del carrito:",this.cartItems),console.log("Total del carrito:",this.total)},e=>{console.error("Error al cargar el carrito:",e)})}loadCustomerData(){const e=localStorage.getItem("customerData");if(e){const t=JSON.parse(e);this.customerForm.patchValue(t)}}toggleClienteForm(){this.showClienteForm&&this.resetClienteForm(),this.showClienteForm=!this.showClienteForm}resetClienteForm(){this.customerForm.reset()}removeItem(e){this.cartService.eliminar_carrito(e).subscribe(()=>{this.loadCart()})}agregarItem(e){this.cartService.agregar_Carrito(e).subscribe(()=>{this.loadCart()})}bajarItem(e){this.cartService.restar_carrito(e).subscribe(()=>{this.loadCart()})}calcularTotalCarrito(){let e=0;return this.carrito&&Array.isArray(this.carrito.items)?this.carrito.items.forEach(t=>{e+=t.precio*t.cantidad}):console.error("El carrito no tiene items v\xe1lidos:",this.carrito),e}mostrarToast(e){var t=this;return(0,p.A)(function*(){yield(yield t.toastController.create({message:e,duration:3e3,position:"top",color:"dark"})).present()})()}buscar_cliente(e){e&&this.cartService.cliente_obtener(e).subscribe(t=>{t&&(this.customer.dv=t.dv,this.customer.correo_electronico=t.correo_electronico,this.customer.nombre=t.nombre,this.customer.direccion=t.direccion)})}validateForm(){return!this.customerForm.invalid||(this.mostrarToast("Por favor, completa el formulario correctamente."),!1)}checkout_pago(){if(0===this.cartItems.length)return void this.mostrarToast("El carrito est\xe1 vac\xedo. Agrega productos antes de proceder al pago.");if(!this.validateForm())return void this.mostrarToast("Completa el formulario antes de seguir.");const e=this.cartItems.map(r=>({producto_id:r.producto_id,cantidad:r.cantidad})),n={...this.customerForm.value,items:e,total:this.total};this.cartService.checkout(n).subscribe(r=>{r&&r.orden_id?(this.mostrarToast(`Orden creada. ID de la orden: ${r.orden_id}`),this.irAPagar(r.orden_id)):this.mostrarToast("Error: No se recibi\xf3 el ID de la orden.")},r=>{console.error("Error al crear la orden",r),this.mostrarToast("Error al crear la orden. Int\xe9ntalo de nuevo.")})}irAPagar(e){this.validateForm()?this.cartService.iniciarPago({total:this.total,orden_id:e}).subscribe(t=>{if(console.log(t),t.success){const n=document.createElement("form");n.method="POST",n.action=t.transaction_url;const r=document.createElement("input");r.type="hidden",r.name="token_ws",r.value=t.token,n.appendChild(r),document.body.appendChild(n),n.submit()}else alert("Error al iniciar pago: "+t.message)},t=>{console.error(t),alert("Ocurri\xf3 un error al iniciar el pago.")}):this.mostrarToast("Por favor, completa todos los campos.")}}return(i=s).\u0275fac=function(e){return new(e||i)(o.rXU(f.D),o.rXU(c.K_),o.rXU(m.Ix),o.rXU(a.ok))},i.\u0275cmp=o.VBU({type:i,selectors:[["app-carrito"]],decls:51,vars:13,consts:[[3,"fullscreen"],[1,"fondo"],["size-md","5","size-lg","4"],[1,"titular","datos-cliente-title",2,"color","black","font-weight","bold"],[1,"list-group","mb-3"],["style","background: rgb(160, 214, 131); color: black; font-weight: bold; font-size: 20px;","class","list-group-item d-flex justify-content-between lh-sm",4,"ngFor","ngForOf"],[1,"list-group-item","d-flex","justify-content-between",2,"background","rgb(160, 214, 131)","color","black","font-weight","bold","font-size","20px"],["size-md","7","size-lg","8"],[3,"formGroup"],[1,"g-3",2,"color","black","font-weight","bold"],["size","6"],[1,""],["name","rut","placeholder"," 12345678","formControlName","rut",1,"input-form",3,"ngModelChange","ionBlur","ngModel"],["size","6",2,"color","gray"],["position","stacked",1,"form-label"],["type","text","name","dv","placeholder"," 0","formControlName","dv",1,"input-form",2,"color","gray",3,"ngModelChange","ngModel"],["size","12",2,"color","gray"],["type","email","name","correo_electronico","placeholder"," ejemplo@gmai..com","formControlName","correo_electronico",1,"input-form",2,"color","gray",3,"ngModelChange","ngModel"],["formControlName","contrasena","placeholder"," ########",1,"input-form",3,"ngModelChange","type","ngModel"],["slot","end",2,"cursor","pointer",3,"click","name"],["type","text","name","nombre","placeholder"," Primer nombre ","formControlName","nombre",1,"input-form",3,"ngModelChange","ngModel"],["type","text","name","direccion","placeholder"," Ejemplo calle #123","formControlName","direccion",1,"input-form",3,"ngModelChange","ngModel"],[1,"my-2",2,"color","gray"],["expand","block",1,"btn","btn-primary",3,"click"],["class","text-center mt-4",4,"ngIf"],[1,"list-group-item","d-flex","justify-content-between","lh-sm",2,"background","rgb(160, 214, 131)","color","black","font-weight","bold","font-size","20px"],[1,"my-0",2,"background","rgb(160, 214, 131)","color","black","font-weight","bold","font-size","24px"],[1,"text-body-secondary",2,"background","rgb(160, 214, 131)","color","black","font-weight","bold","font-size","20px"],[1,"precio",2,"color","black","font-weight","800","font-size","20px"],[1,"d-flex"],[1,"aumentar-disminuir"],[3,"click"],["color","danger",3,"click"],["slot","icon-only","name","trash-outline"],[1,"text-center","mt-4"]],template:function(e,t){1&e&&(o.j41(0,"ion-content",0)(1,"main")(2,"ion-grid",1),o.nrm(3,"ion-row"),o.j41(4,"ion-row")(5,"ion-col",2)(6,"h1",3),o.EFF(7,"Carritode compras"),o.k0s(),o.nrm(8,"br"),o.j41(9,"div")(10,"ul",4),o.DNE(11,b,18,4,"li",5),o.j41(12,"li",6)(13,"span"),o.EFF(14,"Total (CLP)"),o.k0s(),o.j41(15,"strong"),o.EFF(16),o.k0s()()()()(),o.j41(17,"ion-col",7)(18,"form",8)(19,"h4",3),o.EFF(20,"Datos del cliente"),o.k0s(),o.j41(21,"ion-row",9)(22,"ion-col",10)(23,"ion-label",11),o.EFF(24,"RUT"),o.k0s(),o.j41(25,"ion-input",12),o.mxI("ngModelChange",function(r){return o.DH7(t.customer.rut,r)||(t.customer.rut=r),r}),o.bIt("ionBlur",function(){return t.buscar_cliente(t.customer.rut)}),o.k0s()(),o.j41(26,"ion-col",13)(27,"ion-label",14),o.EFF(28,"DV"),o.k0s(),o.j41(29,"ion-input",15),o.mxI("ngModelChange",function(r){return o.DH7(t.customer.dv,r)||(t.customer.dv=r),r}),o.k0s()(),o.j41(30,"ion-col",16)(31,"ion-label",14),o.EFF(32,"Correo Electr\xf3nico"),o.k0s(),o.j41(33,"ion-input",17),o.mxI("ngModelChange",function(r){return o.DH7(t.customer.correo_electronico,r)||(t.customer.correo_electronico=r),r}),o.k0s()(),o.j41(34,"ion-col",16)(35,"ion-label",14),o.EFF(36,"Contrase\xf1a"),o.k0s(),o.j41(37,"ion-input",18),o.mxI("ngModelChange",function(r){return o.DH7(t.customer.contrasena,r)||(t.customer.contrasena=r),r}),o.j41(38,"ion-icon",19),o.bIt("click",function(){return t.togglePasswordVisibility("register")}),o.k0s()()(),o.j41(39,"ion-col",16)(40,"ion-label",14),o.EFF(41,"Nombre"),o.k0s(),o.j41(42,"ion-input",20),o.mxI("ngModelChange",function(r){return o.DH7(t.customer.nombre,r)||(t.customer.nombre=r),r}),o.k0s()(),o.j41(43,"ion-col",16)(44,"ion-label",14),o.EFF(45,"Direcci\xf3n"),o.k0s(),o.j41(46,"ion-input",21),o.mxI("ngModelChange",function(r){return o.DH7(t.customer.direccion,r)||(t.customer.direccion=r),r}),o.k0s()()(),o.nrm(47,"hr",22),o.j41(48,"button",23),o.bIt("click",function(){return t.checkout_pago()}),o.EFF(49,"Pagar"),o.k0s()()()(),o.DNE(50,C,3,0,"div",24),o.k0s()()()),2&e&&(o.Y8G("fullscreen",!0),o.R7$(11),o.Y8G("ngForOf",null==t.carrito?null:t.carrito.items),o.R7$(5),o.SpI("$",t.total,""),o.R7$(2),o.Y8G("formGroup",t.customerForm),o.R7$(7),o.R50("ngModel",t.customer.rut),o.R7$(4),o.R50("ngModel",t.customer.dv),o.R7$(4),o.R50("ngModel",t.customer.correo_electronico),o.R7$(4),o.Y8G("type",t.showPasswordRegister?"text":"password"),o.R50("ngModel",t.customer.contrasena),o.R7$(),o.Y8G("name",t.showPasswordRegister?"eye-off":"eye"),o.R7$(4),o.R50("ngModel",t.customer.nombre),o.R7$(4),o.R50("ngModel",t.customer.direccion),o.R7$(4),o.Y8G("ngIf",0===(null==t.carrito||null==t.carrito.items?null:t.carrito.items.length)))},dependencies:[u.Sq,u.bT,a.qT,a.BC,a.cb,c.Jm,c.hU,c.W9,c.lO,c.iq,c.$w,c.he,c.ln,c.Gw,a.j4,a.JD],styles:['@charset "UTF-8";ion-button[_ngcontent-%COMP%]{--background: yellow;--color: black;padding:4px}.ajustar[_ngcontent-%COMP%]{text-align:center;display:flex;justify-content:center;align-items:center}.fondo[_ngcontent-%COMP%]{width:100%;min-height:100vh;background:#f5f5f5}ion-label[_ngcontent-%COMP%]{flex:1;text-align:center}.aumentar-disminuir[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}ion-button[_ngcontent-%COMP%]{--padding-start: 5px;--padding-end: 5px}.input-form[_ngcontent-%COMP%]{color:#000;background-color:#a0d683;border:1px solid black;font-weight:700;padding:8px 12px;border-radius:4px;color:gray;font-size:1rem;width:100%;box-sizing:border-box}.input-form[_ngcontent-%COMP%]:focus{outline:none;border-color:#72bf78;box-shadow:0 0 5px #72bf78 a(0,128,0,.5)}.custom-input[_ngcontent-%COMP%]::placeholder{font-style:italic;color:gray;font-size:14px;font-weight:400}.titular[_ngcontent-%COMP%]{background-color:#a0d683;color:#000;display:flex;justify-content:center;align-items:center;font-weight:700;text-align:center;font-family:Bebas Neue,sans-serif;font-size:40px;box-shadow:0 10px 10px #0000001a}.titulard[_ngcontent-%COMP%]{margin:0;background-color:#72bf78;color:#000;max-width:300px;display:flex;justify-content:center;align-items:center;font-weight:700;text-align:center;font-family:Bebas Neue,sans-serif;font-size:40px;box-shadow:0 10px 10px #0000001a}.datos-cliente-title[_ngcontent-%COMP%]{margin-top:0;margin-bottom:1rem}.carito[_ngcontent-%COMP%]{background:#a0d683;color:#000;font-weight:700}.btn-primary[_ngcontent-%COMP%]{background-color:#a0d683;border-color:#a0d683;color:#000;font-size:1rem;padding:8px 20px;border-radius:8px;width:100%;max-width:1250px;text-align:center;transition:all .3s ease;border:solid 1px black}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#feff9f;border-color:#feff9f;border:solid 1px black}.btn-outline-secondary[_ngcontent-%COMP%]{color:#000;border-color:#333;font-size:1rem;padding:8px 20px;border-radius:8px;width:100%;max-width:1250px;text-align:center;transition:all .3s ease}.btn-outline-secondary[_ngcontent-%COMP%]:hover{background-color:#feff9f;color:#000;border-color:#feff9f;border:solid 1px black}span.text-body-secondary[_ngcontent-%COMP%]{margin:0;padding:0;display:inline}.precio[_ngcontent-%COMP%]{position:relative;text-align:center;align-items:center}@media (max-width: 768px){.btn-primary[_ngcontent-%COMP%], .btn-outline-secondary[_ngcontent-%COMP%]{font-size:.9rem;padding:6px 16px}}']}),s})()}];let k=(()=>{var i;class s{}return(i=s).\u0275fac=function(e){return new(e||i)},i.\u0275mod=o.$C({type:i}),i.\u0275inj=o.G2t({imports:[m.iI.forChild(_),m.iI]}),s})(),P=(()=>{var i;class s{}return(i=s).\u0275fac=function(e){return new(e||i)},i.\u0275mod=o.$C({type:i}),i.\u0275inj=o.G2t({imports:[u.MD,a.YN,c.bv,k,a.X1]}),s})()}}]);
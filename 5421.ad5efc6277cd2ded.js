"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5421],{5421:(X,P,u)=>{u.r(P),u.d(P,{PanelProveedorPageModule:()=>N});var p=u(177),l=u(4341),a=u(4742),m=u(6766),d=u(467),f=u(1626),v=u(5964),e=u(3953),h=u(459),F=u(3114);function b(n,c){1&n&&(e.j41(0,"div")(1,"h2"),e.EFF(2,"Dashboard"),e.k0s(),e.j41(3,"p"),e.EFF(4,"Aqu\xed puedes mostrar estad\xedsticas, gr\xe1ficos, y otros res\xfamenes."),e.k0s()())}function j(n,c){if(1&n){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-label")(2,"h2"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.nI1(6,"currency"),e.k0s(),e.j41(7,"p"),e.EFF(8),e.k0s()(),e.j41(9,"ion-button",13),e.bIt("click",function(){const o=e.eBV(t).$implicit,i=e.XpG(4);return e.Njj(i.editar(o.codigo_producto))}),e.EFF(10,"Editar"),e.k0s(),e.j41(11,"ion-button",14),e.bIt("click",function(){const o=e.eBV(t).$implicit,i=e.XpG(4);return e.Njj(i.eliminar(o.codigo_producto))}),e.EFF(12,"Eliminar"),e.k0s()()}if(2&n){const t=c.$implicit;e.R7$(3),e.JRh(t.nombre_producto),e.R7$(2),e.SpI("Precio: ",e.bMT(6,3,t.precio),""),e.R7$(3),e.SpI("Imagen: ",t.imagen_producto,"")}}function k(n,c){if(1&n&&(e.j41(0,"ion-list"),e.DNE(1,j,13,5,"ion-item",12),e.k0s()),2&n){const t=e.XpG(3);e.R7$(),e.Y8G("ngForOf",t.products)}}function E(n,c){if(1&n&&(e.j41(0,"ion-card")(1,"ion-card-content"),e.DNE(2,k,2,1,"ion-list",11),e.k0s()()),2&n){e.XpG();const t=e.sdS(5),r=e.XpG();e.R7$(2),e.Y8G("ngIf",r.products.length>0)("ngIfElse",t)}}function I(n,c){1&n&&(e.j41(0,"p"),e.EFF(1,"No hay productos para mostrar."),e.k0s())}function S(n,c){if(1&n&&(e.j41(0,"ion-select-option",24),e.EFF(1),e.k0s()),2&n){const t=c.$implicit;e.Y8G("value",t.id),e.R7$(),e.JRh(t.nombre_categoria)}}function T(n,c){if(1&n){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3),e.k0s()(),e.j41(4,"ion-card-content")(5,"form",15),e.bIt("ngSubmit",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.putProducto(o.productoSeleccionado))}),e.j41(6,"ion-item")(7,"ion-label",16),e.EFF(8,"Nombre del Producto"),e.k0s(),e.nrm(9,"ion-input",17),e.k0s(),e.j41(10,"ion-item")(11,"ion-label",16),e.EFF(12,"Precio"),e.k0s(),e.nrm(13,"ion-input",18),e.k0s(),e.j41(14,"ion-item")(15,"ion-label",16),e.EFF(16,"Imagen del Producto"),e.k0s(),e.j41(17,"input",19),e.bIt("change",function(o){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onFileSelected(o))}),e.k0s()(),e.j41(18,"ion-item")(19,"ion-label",16),e.EFF(20,"Categor\xeda"),e.k0s(),e.j41(21,"ion-select",20),e.DNE(22,S,2,2,"ion-select-option",21),e.k0s()(),e.j41(23,"ion-button",22),e.EFF(24,"Editar producto"),e.k0s(),e.j41(25,"ion-button",23),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.desEditar())}),e.EFF(26,"Dejar de editar"),e.k0s()()()()}if(2&n){const t=e.XpG(2);e.R7$(3),e.SpI(" Editar producto ",t.productoSeleccionado," "),e.R7$(2),e.Y8G("formGroup",t.editarForm),e.R7$(17),e.Y8G("ngForOf",t.categorias)}}function G(n,c){if(1&n&&(e.j41(0,"ion-select-option",24),e.EFF(1),e.k0s()),2&n){const t=c.$implicit;e.Y8G("value",t.id_categoria),e.R7$(),e.JRh(t.nombre_categoria)}}function R(n,c){if(1&n){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3,"Agregar Producto"),e.k0s()(),e.j41(4,"ion-card-content")(5,"form",25)(6,"ion-item")(7,"ion-label",16),e.EFF(8,"Nombre del Producto"),e.k0s(),e.nrm(9,"ion-input",17),e.k0s(),e.j41(10,"ion-item")(11,"ion-label",16),e.EFF(12,"Precio"),e.k0s(),e.nrm(13,"ion-input",18),e.k0s(),e.j41(14,"ion-item")(15,"ion-label",16),e.EFF(16,"Imagen del Producto"),e.k0s(),e.j41(17,"input",19),e.bIt("change",function(o){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onFileSelected(o))}),e.k0s()(),e.j41(18,"ion-item")(19,"ion-label",16),e.EFF(20,"Categor\xeda"),e.k0s(),e.j41(21,"ion-select",20),e.DNE(22,G,2,2,"ion-select-option",21),e.k0s()(),e.j41(23,"ion-button",26),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.postProducto())}),e.EFF(24,"Agregar Producto"),e.k0s()()()()}if(2&n){const t=e.XpG(2);e.R7$(5),e.Y8G("formGroup",t.productoForm),e.R7$(17),e.Y8G("ngForOf",t.categorias)}}function y(n,c){if(1&n&&(e.j41(0,"div")(1,"h2"),e.EFF(2,"Gesti\xf3n de Productos"),e.k0s(),e.DNE(3,E,3,2,"ion-card",10)(4,I,2,0,"ng-template",null,0,e.C5r)(6,T,27,3,"ion-card",10)(7,R,25,2,"ion-card",10),e.k0s()),2&n){const t=e.XpG();e.R7$(3),e.Y8G("ngIf",0==t.isEditMode),e.R7$(3),e.Y8G("ngIf",1==t.isEditMode&&t.productoSeleccionado),e.R7$(),e.Y8G("ngIf",0==t.isEditMode)}}function M(n,c){if(1&n){const t=e.RV6();e.j41(0,"div")(1,"h2"),e.EFF(2,"Mi Cuenta"),e.k0s(),e.j41(3,"ion-card")(4,"ion-card-content")(5,"ion-list")(6,"ion-item")(7,"ion-label",16),e.EFF(8,"Nombre"),e.k0s(),e.j41(9,"ion-input",27),e.mxI("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.DH7(i.proveedor.nombre,o)||(i.proveedor.nombre=o),e.Njj(o)}),e.k0s()(),e.j41(10,"ion-item")(11,"ion-label",16),e.EFF(12,"Apellido"),e.k0s(),e.j41(13,"ion-input",27),e.mxI("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.DH7(i.proveedor.apellido,o)||(i.proveedor.apellido=o),e.Njj(o)}),e.k0s()(),e.j41(14,"ion-item")(15,"ion-label",16),e.EFF(16,"Correo Electr\xf3nico"),e.k0s(),e.j41(17,"ion-input",27),e.mxI("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.DH7(i.proveedor.correo_electronico,o)||(i.proveedor.correo_electronico=o),e.Njj(o)}),e.k0s()(),e.j41(18,"ion-item")(19,"ion-label",16),e.EFF(20,"Foto"),e.k0s(),e.j41(21,"input",28),e.bIt("change",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.actualizarFoto(o))}),e.k0s()()(),e.j41(22,"ion-button",23),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.actualizarPerfil())}),e.EFF(23,"Guardar Cambios"),e.k0s()()()()}if(2&n){const t=e.XpG();e.R7$(9),e.R50("ngModel",t.proveedor.nombre),e.R7$(4),e.R50("ngModel",t.proveedor.apellido),e.R7$(4),e.R50("ngModel",t.proveedor.correo_electronico)}}const x=[{path:"",component:(()=>{var n;class c{constructor(r,o,i,s,_,g){this.authService=r,this.router=o,this.proService=i,this.toast=s,this.formBuilder=_,this.cdr=g,this.productoSeleccionado=null,this.products=[],this.selectedImage=null,this.isEditMode=!1,this.categorias=[],this.currentSection="dashboard",this.proveedor={},this.fotoSeleccionada=null,this.productoForm=this.formBuilder.group({nombre_producto:["",[l.k0.required]],precio:[0,[l.k0.required]],imagen_producto:["",[l.k0.required]],id_categoria:[0,[l.k0.required]]}),this.editarForm=this.formBuilder.group({nombre_producto:[""],precio:[0],imagen_producto:[""],id_categoria:[0],id_proveedor:[""]})}ngOnInit(){this.router.events.pipe((0,v.p)(r=>r instanceof m.wF)).subscribe(()=>{this.loadPerfil(),this.getProductos()}),this.getCategorias(),this.rutProveedor=localStorage.getItem("rut"),this.rutProveedor?this.getProductos():console.error("No se encontr\xf3 el RUT del proveedor en el localStorage")}loadPerfil(){this.authService.getProveedorPerfil().subscribe(r=>{this.proveedor=r},r=>{console.error("Error al cargar el perfil",r)})}actualizarFoto(r){const o=r.target;o.files&&o.files[0]&&(this.fotoSeleccionada=o.files[0])}actualizarPerfil(){var r=this;localStorage.getItem("rut");const i=new FormData;i.append("nombre",this.proveedor.nombre),i.append("apellido",this.proveedor.apellido),i.append("correo_electronico",this.proveedor.correo_electronico),this.fotoSeleccionada&&i.append("foto",this.fotoSeleccionada),this.authService.actualizarPerfilProveedor(i).subscribe(function(){var s=(0,d.A)(function*(_){(yield r.toast.create({message:"Perfil actualizado correctamente.",duration:2e3})).present()});return function(_){return s.apply(this,arguments)}}(),s=>{console.error("Error al actualizar el perfil",s)})}setSection(r){this.currentSection=r}onFileSelected(r){const o=r.target.files[0];if(o){const i=new FileReader;i.onload=s=>{this.selectedImage=s.target.result},i.readAsDataURL(o)}}showToast(r){var o=this;return(0,d.A)(function*(){(yield o.toast.create({message:r,duration:2e3,position:"top"})).present()})()}getProductos(){this.rutProveedor?this.proService.getProductosByProveedor(this.rutProveedor).subscribe(r=>{this.products=r}):console.error("No se encontr\xf3 el RUT del proveedor en el localStorage")}postProducto(){var r=this;return(0,d.A)(function*(){r.productoForm.value.imagen_producto=r.selectedImage,r.proService.agregarProducto(r.productoForm.value).subscribe(function(){var o=(0,d.A)(function*(i){r.showToast("Producto agregado correctamente."),r.getProductos(),r.productoForm.reset(),r.selectedImage=null});return function(i){return o.apply(this,arguments)}}(),function(){var o=(0,d.A)(function*(i){console.error("Error al crear el producto:",i),yield r.showToast("Error al agregar el producto.")});return function(i){return o.apply(this,arguments)}}())})()}editar(r){this.isEditMode=!this.isEditMode,this.productoSeleccionado=r,this.proService.getProductoById(r).subscribe(o=>{this.editarForm.patchValue({nombre_producto:o.nombre,precio:o.precio,id_categoria:o.id_categoria,id_proveedor:o.id_proveedor,imagen_producto:o.imagen_producto,rut_proveedor:o.id_proveedor}),console.log(o),console.log(this.editarForm.value),this.cdr.detectChanges()})}desEditar(){this.productoSeleccionado=null,this.isEditMode=!this.isEditMode}putProducto(r){var o=this;null!=this.selectedImage&&(this.editarForm.value.imagen_producto=this.selectedImage),console.log("Valores a modificar",this.editarForm.value),this.proService.modificarProducto(r,this.editarForm.value).subscribe(function(){var i=(0,d.A)(function*(s){yield o.showToast("Producto modificado correctamente."),o.getProductos()});return function(s){return i.apply(this,arguments)}}(),function(){var i=(0,d.A)(function*(s){console.error("Error al modificar el producto:",s),yield o.showToast("Error al modificar el producto.")});return function(s){return i.apply(this,arguments)}}()),this.productoSeleccionado=null,this.isEditMode=!this.isEditMode}eliminar(r){var o=this;return(0,d.A)(function*(){o.proService.eliminarProducto(r).subscribe(function(){var i=(0,d.A)(function*(s){yield o.showToast("Producto eliminado correctamente."),o.getProductos()});return function(s){return i.apply(this,arguments)}}(),function(){var i=(0,d.A)(function*(s){console.error("Error al eliminar el producto:",s),yield o.showToast("Error al eliminar el producto.")});return function(s){return i.apply(this,arguments)}}())})()}getCategorias(){this.proService.getCategorias().subscribe(r=>{this.categorias=r})}onLogout(){var r=this;return(0,d.A)(function*(){const o=localStorage.getItem("authToken"),i=new f.Lr({Authorization:`Token ${o}`});r.authService.logout(i).subscribe(function(){var s=(0,d.A)(function*(_){(yield r.toast.create({message:"Has cerrado sesi\xf3n correctamente.",duration:2e3})).present(),localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("user_data"),localStorage.removeItem("rut"),r.router.navigate(["/login"])});return function(_){return s.apply(this,arguments)}}(),function(){var s=(0,d.A)(function*(_){console.error("Error al cerrar sesi\xf3n:",_),(yield r.toast.create({message:"Error al cerrar sesi\xf3n. Intenta de nuevo.",duration:2e3})).present()});return function(_){return s.apply(this,arguments)}}())})()}}return(n=c).\u0275fac=function(r){return new(r||n)(e.rXU(h.P),e.rXU(m.Ix),e.rXU(F.P),e.rXU(a.K_),e.rXU(l.ok),e.rXU(e.gRc))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-panel-proveedor"]],decls:28,vars:3,consts:[["noProducts",""],["contentId","adminContent"],["side","start","menuId","mainMenu","contentId","adminContent"],["color","primary"],[3,"click"],["slot","start","name","home-outline"],["slot","start","name","people-outline"],["slot","start","name","settings-outline"],["slot","start","name","log-out-outline"],["id","adminContent",1,"main-content"],[4,"ngIf"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],["fill","outline",3,"click"],["color","danger",3,"click"],[3,"ngSubmit","formGroup"],["position","stacked"],["formControlName","nombre_producto","name","nombre_producto","required",""],["formControlName","precio","type","number","name","precio","required",""],["type","file","accept",".png, .jpg, .jpeg, .bmp",3,"change"],["formControlName","id_categoria","name","id_categoria","required",""],[3,"value",4,"ngFor","ngForOf"],["expand","full","type","submit"],["expand","full",3,"click"],[3,"value"],[3,"formGroup"],["expand","full","type","submit",3,"click"],[3,"ngModelChange","ngModel"],["type","file","accept","image/*",3,"change"]],template:function(r,o){1&r&&(e.j41(0,"ion-split-pane",1)(1,"ion-menu",2)(2,"ion-header")(3,"ion-toolbar",3)(4,"ion-title"),e.EFF(5,"Men\xfa"),e.k0s()()(),e.j41(6,"ion-content")(7,"ion-list")(8,"ion-item",4),e.bIt("click",function(){return o.setSection("dashboard")}),e.nrm(9,"ion-icon",5),e.j41(10,"ion-label"),e.EFF(11,"Dashboard"),e.k0s()(),e.j41(12,"ion-item",4),e.bIt("click",function(){return o.setSection("Productos")}),e.nrm(13,"ion-icon",6),e.j41(14,"ion-label"),e.EFF(15,"Productos"),e.k0s()(),e.j41(16,"ion-item",4),e.bIt("click",function(){return o.setSection("Perfil")}),e.nrm(17,"ion-icon",7),e.j41(18,"ion-label"),e.EFF(19,"Perfil"),e.k0s()(),e.j41(20,"ion-item",4),e.bIt("click",function(){return o.onLogout()}),e.nrm(21,"ion-icon",8),e.j41(22,"ion-label"),e.EFF(23,"Cerrar Sesi\xf3n"),e.k0s()()()()(),e.j41(24,"ion-content",9),e.DNE(25,b,5,0,"div",10)(26,y,8,3,"div",10)(27,M,24,3,"div",10),e.k0s()()),2&r&&(e.R7$(25),e.Y8G("ngIf","dashboard"===o.currentSection),e.R7$(),e.Y8G("ngIf","Productos"===o.currentSection),e.R7$(),e.Y8G("ngIf","Perfil"===o.currentSection))},dependencies:[p.Sq,p.bT,l.qT,l.BC,l.cb,l.YS,l.vS,a.Jm,a.b_,a.I9,a.ME,a.tN,a.W9,a.eU,a.iq,a.$w,a.uz,a.he,a.nf,a.oS,a.Nm,a.Ip,a.HP,a.BC,a.ai,a.su,a.Je,a.Gw,l.j4,l.JD,p.oe]}),c})()}];let C=(()=>{var n;class c{}return(n=c).\u0275fac=function(r){return new(r||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[m.iI.forChild(x),m.iI]}),c})(),N=(()=>{var n;class c{}return(n=c).\u0275fac=function(r){return new(r||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[p.MD,l.YN,a.bv,C,l.X1]}),c})()}}]);
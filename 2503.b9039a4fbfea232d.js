"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2503],{2503:(j,m,d)=>{d.r(m),d.d(m,{CarritoPageModule:()=>M});var u=d(177),a=d(4341),l=d(4742),g=d(6766),p=d(467),_=d(5964),t=d(3953),h=d(9368);const f=()=>["/catalogo-producto"];function x(i,s){if(1&i){const r=t.RV6();t.j41(0,"ion-item",22)(1,"ion-label",23),t.EFF(2),t.k0s(),t.j41(3,"ion-label",24),t.EFF(4),t.k0s(),t.j41(5,"div",25)(6,"ion-button",26),t.bIt("click",function(){const o=t.eBV(r).$implicit,n=t.XpG(2);return t.Njj(n.bajarItem(o.producto_id))}),t.EFF(7,"-"),t.k0s(),t.j41(8,"p"),t.EFF(9),t.k0s(),t.j41(10,"ion-button",26),t.bIt("click",function(){const o=t.eBV(r).$implicit,n=t.XpG(2);return t.Njj(n.agregarItem(o.producto_id))}),t.EFF(11,"+"),t.k0s()(),t.j41(12,"ion-label",5),t.EFF(13),t.k0s(),t.j41(14,"ion-button",27),t.bIt("click",function(){const o=t.eBV(r).$implicit,n=t.XpG(2);return t.Njj(n.removeItem(o.producto_id))}),t.nrm(15,"ion-icon",28),t.k0s()()}if(2&i){const r=s.$implicit,e=t.XpG(2);t.R7$(2),t.JRh(r.nombre),t.R7$(2),t.SpI("$",r.precio," CLP"),t.R7$(5),t.SpI(" ",r.cantidad," "),t.R7$(4),t.SpI("$",e.precioUnitario(r.precio,r.cantidad)," CLP")}}function b(i,s){if(1&i&&(t.j41(0,"ion-list",20),t.DNE(1,x,16,4,"ion-item",21),t.k0s()),2&i){const r=t.XpG();t.R7$(),t.Y8G("ngForOf",r.carrito.items)}}function C(i,s){if(1&i){const r=t.RV6();t.j41(0,"div")(1,"ion-col",2)(2,"div",3),t.EFF(3,"Formulario de datos"),t.k0s()(),t.j41(4,"ion-card",29)(5,"ion-card-content")(6,"form",30),t.nrm(7,"div",31),t.j41(8,"ion-row",32)(9,"ion-col",33)(10,"ion-label",34),t.EFF(11,"RUT"),t.k0s(),t.j41(12,"ion-input",35),t.mxI("ngModelChange",function(o){t.eBV(r);const n=t.XpG();return t.DH7(n.customer.rut,o)||(n.customer.rut=o),t.Njj(o)}),t.bIt("ionBlur",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.buscar_cliente(o.customer.rut))}),t.k0s()(),t.j41(13,"ion-col")(14,"ion-label",34),t.EFF(15,"DV"),t.k0s(),t.j41(16,"ion-input",36),t.mxI("ngModelChange",function(o){t.eBV(r);const n=t.XpG();return t.DH7(n.customer.dv,o)||(n.customer.dv=o),t.Njj(o)}),t.k0s()()(),t.j41(17,"ion-row",32)(18,"ion-col")(19,"ion-label",34),t.EFF(20,"Correo Electr\xf3nico"),t.k0s(),t.j41(21,"ion-input",37),t.mxI("ngModelChange",function(o){t.eBV(r);const n=t.XpG();return t.DH7(n.customer.correo_electronico,o)||(n.customer.correo_electronico=o),t.Njj(o)}),t.k0s()(),t.j41(22,"ion-col")(23,"ion-label",34),t.EFF(24,"Contrase\xf1a"),t.k0s(),t.j41(25,"ion-input",38),t.mxI("ngModelChange",function(o){t.eBV(r);const n=t.XpG();return t.DH7(n.customer.contrasena,o)||(n.customer.contrasena=o),t.Njj(o)}),t.j41(26,"ion-icon",39),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.togglePasswordVisibility("register"))}),t.k0s()()(),t.j41(27,"ion-col")(28,"ion-label",34),t.EFF(29,"Nombre"),t.k0s(),t.j41(30,"ion-input",40),t.mxI("ngModelChange",function(o){t.eBV(r);const n=t.XpG();return t.DH7(n.customer.nombre,o)||(n.customer.nombre=o),t.Njj(o)}),t.k0s()(),t.j41(31,"ion-col")(32,"ion-label",34),t.EFF(33,"Direcci\xf3n"),t.k0s(),t.j41(34,"ion-input",41),t.mxI("ngModelChange",function(o){t.eBV(r);const n=t.XpG();return t.DH7(n.customer.direccion,o)||(n.customer.direccion=o),t.Njj(o)}),t.k0s()()(),t.j41(35,"div",42)(36,"ion-button",43),t.bIt("click",function(){t.eBV(r);const o=t.XpG();return t.Njj(o.checkout_pago())}),t.EFF(37,"Pagar"),t.k0s()()()()()()}if(2&i){const r=t.XpG();t.R7$(6),t.Y8G("formGroup",r.customerForm),t.R7$(6),t.R50("ngModel",r.customer.rut),t.R7$(4),t.R50("ngModel",r.customer.dv),t.R7$(5),t.R50("ngModel",r.customer.correo_electronico),t.R7$(4),t.Y8G("type",r.showPasswordRegister?"text":"password"),t.R50("ngModel",r.customer.contrasena),t.R7$(),t.Y8G("name",r.showPasswordRegister?"eye-off":"eye"),t.R7$(4),t.R50("ngModel",r.customer.nombre),t.R7$(4),t.R50("ngModel",r.customer.direccion),t.R7$(2),t.Y8G("disabled",r.customerForm.invalid)}}function k(i,s){1&i&&(t.j41(0,"ion-item",44)(1,"ion-label"),t.EFF(2,"El carrito est\xe1 vac\xedo"),t.k0s()())}const P=[{path:"",component:(()=>{var i;class s{togglePasswordVisibility(e){"register"===e&&(this.showPasswordRegister=!this.showPasswordRegister)}constructor(e,o,n,c){this.cartService=e,this.toastController=o,this.router=n,this.fb=c,this.cartItems=[],this.total=0,this.customer={rut:"",dv:"",correo_electronico:"",contrasena:"",nombre:"",direccion:""},this.mensaje="",this.showClienteForm=!1,this.showPasswordRegister=!1,this.customerForm=this.fb.group({rut:["",[a.k0.required,a.k0.pattern("^[0-9]+$"),a.k0.minLength(7),a.k0.maxLength(8)]],dv:["",[a.k0.required,a.k0.pattern("^[0-9Kk]{1}$")]],correo_electronico:["",[a.k0.required,a.k0.email]],contrasena:["",[a.k0.required,a.k0.minLength(8),a.k0.maxLength(16),a.k0.pattern(/(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])/)]],nombre:["",a.k0.required,a.k0.pattern("^[a-zA-Z\xf1\xd1]+$")],direccion:["",a.k0.required]})}ngOnInit(){this.loadCart(),this.loadCustomerData(),this.router.events.pipe((0,_.p)(e=>e instanceof g.wF)).subscribe(()=>{this.loadCart()})}precioUnitario(e,o){return e*o}loadCart(){this.cartService.ver_carrito().subscribe(e=>{this.carrito=e,this.cartItems=e.items,this.total=Number(e.total),console.log("Carrito cargado:",this.carrito),console.log("Items del carrito:",this.cartItems),console.log("Total del carrito:",this.total)},e=>{console.error("Error al cargar el carrito:",e)})}loadCustomerData(){const e=localStorage.getItem("customerData");if(e){const o=JSON.parse(e);this.customerForm.patchValue(o)}}toggleClienteForm(){this.showClienteForm&&this.resetClienteForm(),this.showClienteForm=!this.showClienteForm}resetClienteForm(){this.customerForm.reset()}removeItem(e){this.cartService.eliminar_carrito(e).subscribe(()=>{this.loadCart()})}agregarItem(e){this.cartService.agregar_Carrito(e).subscribe(()=>{this.loadCart()})}bajarItem(e){this.cartService.restar_carrito(e).subscribe(()=>{this.loadCart()})}calcularTotalCarrito(){let e=0;return this.carrito&&Array.isArray(this.carrito.items)?this.carrito.items.forEach(o=>{e+=o.precio*o.cantidad}):console.error("El carrito no tiene items v\xe1lidos:",this.carrito),e}mostrarToast(e){var o=this;return(0,p.A)(function*(){yield(yield o.toastController.create({message:e,duration:3e3,position:"top",color:"dark"})).present()})()}buscar_cliente(e){e&&this.cartService.cliente_obtener(e).subscribe(o=>{o&&(this.customer.dv=o.dv,this.customer.correo_electronico=o.correo_electronico,this.customer.nombre=o.nombre,this.customer.direccion=o.direccion)})}validateForm(){return!this.customerForm.invalid||(this.mostrarToast("Por favor, completa el formulario correctamente."),!1)}checkout_pago(){if(0===this.cartItems.length)return void this.mostrarToast("El carrito est\xe1 vac\xedo. Agrega productos antes de proceder al pago.");if(!this.validateForm())return void this.mostrarToast("Completa el formulario antes de seguir.");const e=this.cartItems.map(c=>({producto_id:c.producto_id,cantidad:c.cantidad})),n={...this.customerForm.value,items:e,total:this.total};this.cartService.checkout(n).subscribe(c=>{c&&c.orden_id?(this.mostrarToast(`Orden creada. ID de la orden: ${c.orden_id}`),this.irAPagar(c.orden_id)):this.mostrarToast("Error: No se recibi\xf3 el ID de la orden.")},c=>{console.error("Error al crear la orden",c),this.mostrarToast("Error al crear la orden. Int\xe9ntalo de nuevo.")})}irAPagar(e){this.validateForm()?this.cartService.iniciarPago({total:this.total,orden_id:e}).subscribe(o=>{if(console.log(o),o.success){const n=document.createElement("form");n.method="POST",n.action=o.transaction_url;const c=document.createElement("input");c.type="hidden",c.name="token_ws",c.value=o.token,n.appendChild(c),document.body.appendChild(n),n.submit()}else alert("Error al iniciar pago: "+o.message)},o=>{console.error(o),alert("Ocurri\xf3 un error al iniciar el pago.")}):this.mostrarToast("Por favor, completa todos los campos.")}}return(i=s).\u0275fac=function(e){return new(e||i)(t.rXU(h.D),t.rXU(l.K_),t.rXU(g.Ix),t.rXU(a.ok))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-carrito"]],decls:58,vars:7,consts:[["noItems",""],[1,"fondo"],[1,"centrar"],[1,"titular"],[1,"header-row","ion-justify-content-center","ion-align-items-center"],[1,"precio"],[1,"ion-justify-content-center","ion-align-items-center"],["size","12","size-md","10","size-lg","8"],["class","listacarro",4,"ngIf","ngIfElse"],[1,"botonespagar"],[1,"bpagar",3,"routerLink"],[1,"total"],[1,"bpagar",3,"click"],[4,"ngIf"],[1,"footer"],[1,"container"],[1,"float-end"],["href","#",1,"back-to-top"],[1,"footer-text"],["href","#"],[1,"listacarro"],["color","color2",4,"ngFor","ngForOf"],["color","color2"],["id","nombrep"],[1,"precio-unitario"],[1,"aumentar-disminuir"],[3,"click"],["color","danger",3,"click"],["slot","icon-only","name","trash-outline"],[1,"tarjeta"],[1,"form",3,"formGroup"],[1,"cuadrado"],[1,"rutcompleto"],["size","9"],["position","stacked",1,"label"],["name","rut","placeholder","RUT","formControlName","rut",1,"formulario",3,"ngModelChange","ionBlur","ngModel"],["type","text","name","dv","placeholder","DV","formControlName","dv",1,"dv-input",3,"ngModelChange","ngModel"],["type","email","name","correo_electronico","placeholder","CORREO","formControlName","correo_electronico",1,"formulario",3,"ngModelChange","ngModel"],["formControlName","contrasena","formControlName","contrasena","placeholder","CONTRASE\xd1A",1,"formulario",3,"ngModelChange","type","ngModel"],["slot","end",2,"cursor","pointer",3,"click","name"],["type","text","name","nombre","placeholder","NOMBRE","formControlName","nombre",1,"formulario",3,"ngModelChange","ngModel"],["type","text","name","direccion","placeholder","DIRECCI\xd3N","formControlName","direccion",1,"formulario",3,"ngModelChange","ngModel"],[1,"button-center"],[1,"submit",3,"click","disabled"],["color","1",1,"carritovacio"]],template:function(e,o){if(1&e){const n=t.RV6();t.j41(0,"ion-content")(1,"ion-grid",1)(2,"ion-row")(3,"ion-col",2)(4,"div",3),t.EFF(5,"Tu carrito de compras"),t.k0s()()(),t.j41(6,"ion-row")(7,"ion-col")(8,"ion-row",4)(9,"ion-col")(10,"ion-label"),t.EFF(11,"PRODUCTO"),t.k0s()(),t.j41(12,"ion-col")(13,"ion-label"),t.EFF(14,"PRECIO"),t.k0s()(),t.j41(15,"ion-col")(16,"ion-label"),t.EFF(17,"CANTIDAD"),t.k0s()(),t.j41(18,"ion-col")(19,"ion-label",5),t.EFF(20,"SUBTOTAL"),t.k0s()()(),t.j41(21,"ion-row",6)(22,"ion-col",7),t.DNE(23,b,2,1,"ion-list",8),t.k0s()()()(),t.j41(24,"ion-row",9)(25,"ion-col")(26,"ion-label")(27,"div",10),t.EFF(28,"Seguir comprando"),t.k0s()()(),t.j41(29,"ion-col",11)(30,"ion-label"),t.EFF(31,"Total: "),t.nrm(32,"br"),t.EFF(33),t.k0s()(),t.j41(34,"ion-col")(35,"ion-label")(36,"div",12),t.bIt("click",function(){return t.eBV(n),t.Njj(o.toggleClienteForm())}),t.EFF(37),t.k0s()()()(),t.j41(38,"ion-row")(39,"ion-col"),t.DNE(40,C,38,10,"div",13),t.k0s()()(),t.j41(41,"footer",14)(42,"div",15)(43,"p",16)(44,"a",17),t.EFF(45,"Volver arriba"),t.k0s()(),t.j41(46,"p",18),t.EFF(47," \xa9 2024 "),t.j41(48,"strong"),t.EFF(49,"GreenMarket"),t.k0s(),t.EFF(50," Portafolio. "),t.j41(51,"a",19),t.EFF(52,"Privacidad"),t.k0s(),t.EFF(53," \xb7 "),t.j41(54,"a",19),t.EFF(55,"T\xe9rminos"),t.k0s()()()()(),t.DNE(56,k,3,0,"ng-template",null,0,t.C5r)}if(2&e){const n=t.sdS(57);t.R7$(23),t.Y8G("ngIf",o.carrito&&o.carrito.items.length>0)("ngIfElse",n),t.R7$(4),t.Y8G("routerLink",t.lJ4(6,f)),t.R7$(6),t.SpI("$",o.total,""),t.R7$(4),t.SpI(" ",o.showClienteForm?"Cancelar":"Continuar"," "),t.R7$(3),t.Y8G("ngIf",o.showClienteForm)}},dependencies:[u.Sq,u.bT,a.qT,a.BC,a.cb,l.Jm,l.b_,l.I9,l.hU,l.W9,l.lO,l.iq,l.$w,l.uz,l.he,l.nf,l.ln,l.Gw,l.N7,g.Wk,a.j4,a.JD],styles:['@charset "UTF-8";ion-toolbar[_ngcontent-%COMP%]{position:relative}ion-button[_ngcontent-%COMP%]{--background: yellow;--color: black;padding:4px}button-div[_ngcontent-%COMP%]{cursor:pointer;background-color:#e7f456f7;color:#000;padding:10px 20px;font-size:20px;font-weight:700;border-radius:5px;text-align:center;transition:background-color .3s}.button-div[_ngcontent-%COMP%]:hover{background-color:#0056b3}.card[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.total[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;font-weight:700}.tarjeta[_ngcontent-%COMP%]{background-color:#72bf78;border-radius:20px;box-shadow:0 10px 10px #0000001a;max-width:928px;padding:10px 15px;margin:0 auto}.formulario[_ngcontent-%COMP%]{color:#000;font-weight:700;font-size:18px;background-color:#a0d683;padding:10px;max-width:500px;min-width:300px}.ajustar[_ngcontent-%COMP%]{text-align:center;display:flex;justify-content:center;align-items:center}.centrar[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.titular[_ngcontent-%COMP%]{background-color:#a0d683;color:#000;width:320px;height:60px;display:flex;justify-content:center;align-items:center;font-weight:700;text-align:center;font-family:Bebas Neue,sans-serif;font-size:40px;box-shadow:0 10px 10px #0000001a}.fondo[_ngcontent-%COMP%]{width:100%;min-height:100vh;background:#f5f5f5}.colormenus[_ngcontent-%COMP%]{background:#72bf78;color:#000}.titulo[_ngcontent-%COMP%]{font-weight:700;text-align:center}.header-row[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:700;text-align:center}.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{text-align:center;padding:10px;border-right:2px solid rgb(0,0,0)}.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]:last-child{border-right:none}.bpagar[_ngcontent-%COMP%]{background-color:#feff9f;color:#000;font-weight:700;border-radius:8px;padding:10px 0;box-shadow:0 4px 6px #0000001a;transition:background-color .3s ease;display:flex;justify-content:center;align-items:center;text-align:center}.botonespagar[_ngcontent-%COMP%]{background:#72bf78;color:#000;font-weight:700;display:flex;justify-content:space-between;align-items:center;text-align:center;max-width:928px;padding:10px 15px;margin:0 auto;border-bottom-left-radius:20px;border-bottom-right-radius:20px}.header-row[_ngcontent-%COMP%]{background:#72bf78;color:#000;font-weight:700;display:flex;justify-content:space-between;align-items:center;text-align:center;max-width:928px;padding:10px 15px;border-top-left-radius:20px;border-top-right-radius:20px;margin:0 auto;box-shadow:0 10px 10px #0000001a}.bpagar[_ngcontent-%COMP%]:hover{background-color:#a0d683}.bpagar[_ngcontent-%COMP%]:active{background-color:#233023}.ion-row[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:0;padding-top:0}.listacarro[_ngcontent-%COMP%]{background-color:#a0d683;width:100%;max-width:1000px;border:#2F4232 2px solid;position:relative;justify-content:center;align-items:center;max-width:928px;padding:10px 15px;border-radius:20px;color:#000;margin:0 auto;box-shadow:0 10px 10px #0000001a}ion-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px;width:100%;max-width:1000px}ion-label[_ngcontent-%COMP%]{flex:1;text-align:center}.aumentar-disminuir[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}ion-button[_ngcontent-%COMP%]{--padding-start: 5px;--padding-end: 5px}.label[_ngcontent-%COMP%]{color:#000}.titulo[_ngcontent-%COMP%]{font-weight:700;font-family:Bebas Neue,sans-serif;font-size:50px;color:#000;position:relative;text-align:start;display:flex;justify-content:start;align-items:start}.precio[_ngcontent-%COMP%]{flex:1;position:relative;left:8.9%;text-align:center;color:#000;font-weight:700}.precio-unitario[_ngcontent-%COMP%]{flex:1;position:relative;right:8.3%;text-align:center;color:#000;font-weight:700}#nombrep[_ngcontent-%COMP%]{flex:1;position:relative;right:4%;text-align:center;color:#000;font-weight:700}.color2[_ngcontent-%COMP%]{color:#000}.carritovacio[_ngcontent-%COMP%]{color:#000;background-color:#a0d683;display:flex;align-items:center;text-align:center;font-weight:700;max-width:928px;padding:10px 15px;margin:0 auto;border:rgb(0,0,0) 2px solid;border-radius:10px;box-shadow:0 10px 10px #0000001a}.rutcompleto[_ngcontent-%COMP%]{font-weight:700;font-size:18px;max-width:600px;min-width:300px}.rut-input[_ngcontent-%COMP%]{background-color:#a0d683;color:#000;font-weight:700;font-size:18px;max-width:600px}.dv-input[_ngcontent-%COMP%]{background-color:#a0d683;color:#000;font-weight:700;font-size:18px;width:50px;padding:10px;max-width:600px}.footer[_ngcontent-%COMP%]{background:#72bf78;color:#000;text-align:center;padding:20px 0;box-shadow:0 -4px 10px #0000001a}.footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#feff9f;text-decoration:none;font-weight:700}.footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.footer-text[_ngcontent-%COMP%]{font-size:14px;margin:0}.footer[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#a0d683}.back-to-top[_ngcontent-%COMP%]{background-color:#a0d683;color:#000;padding:8px 12px;border-radius:5px;font-size:12px;font-weight:700;text-decoration:none;transition:all .3s}.back-to-top[_ngcontent-%COMP%]:hover{background-color:#feff9f;color:#000}']}),s})()}];let F=(()=>{var i;class s{}return(i=s).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[g.iI.forChild(P),g.iI]}),s})(),M=(()=>{var i;class s{}return(i=s).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[u.MD,a.YN,l.bv,F,a.X1]}),s})()}}]);
"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4163],{4163:(B,v,m)=>{m.r(v),m.d(v,{LoginPageModule:()=>V});var h=m(177),s=m(4341),p=m(4742),f=m(6766),d=m(467),e=m(3953),F=m(459),b=m(8513);function k(r,u){1&r&&(e.j41(0,"div",21),e.EFF(1," El nombre de usuario o RUT es obligatorio. "),e.k0s())}function x(r,u){1&r&&(e.j41(0,"div",21),e.EFF(1," La contrase\xf1a es obligatoria y debe tener entre 8 y 12 caracteres. "),e.k0s())}function P(r,u){if(1&r){const n=e.RV6();e.j41(0,"div")(1,"form",9),e.bIt("ngSubmit",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.login())}),e.j41(2,"h2",10),e.EFF(3,"Inicio de sesi\xf3n"),e.k0s(),e.j41(4,"div",11)(5,"label",12),e.EFF(6,"Nombre de Usuario o RUT"),e.k0s(),e.nrm(7,"ion-input",13),e.DNE(8,k,2,0,"div",14),e.k0s(),e.j41(9,"div",11)(10,"label",12),e.EFF(11,"Contrase\xf1a"),e.k0s(),e.j41(12,"ion-input",15)(13,"ion-icon",16),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.togglePasswordVisibility("login"))}),e.k0s()(),e.DNE(14,x,2,0,"div",14),e.k0s(),e.j41(15,"ion-button",17),e.EFF(16,"Login"),e.k0s(),e.j41(17,"div",18)(18,"span",19),e.EFF(19,"\xbfNo tienes cuenta?"),e.k0s(),e.j41(20,"ion-button",20),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleButtonClick())}),e.EFF(21,"Reg\xedstrate aqu\xed"),e.k0s()(),e.j41(22,"div",18)(23,"ion-button",20),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.restore())}),e.EFF(24,"Recuperar contrase\xf1a"),e.k0s()()()()}if(2&r){let n,t;const o=e.XpG();e.R7$(),e.Y8G("formGroup",o.loginForm),e.R7$(7),e.Y8G("ngIf",(null==(n=o.campo("username"))?null:n.invalid)&&o.campoTocado("username")),e.R7$(4),e.Y8G("type",o.showPasswordLogin?"text":"password"),e.R7$(),e.Y8G("name",o.showPasswordLogin?"eye-off":"eye"),e.R7$(),e.Y8G("ngIf",(null==(t=o.campo("password"))?null:t.invalid)&&o.campoTocado("password"))}}function y(r,u){if(1&r){const n=e.RV6();e.j41(0,"div")(1,"h2"),e.EFF(2,"Verificar C\xf3digo 2FA"),e.k0s(),e.j41(3,"form",22),e.bIt("ngSubmit",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.onVerify2FA())}),e.j41(4,"label",23),e.EFF(5,"C\xf3digo:"),e.k0s(),e.j41(6,"input",24),e.mxI("ngModelChange",function(o){e.eBV(n);const i=e.XpG();return e.DH7(i.code,o)||(i.code=o),e.Njj(o)}),e.k0s(),e.j41(7,"button",25),e.EFF(8,"Verificar"),e.k0s()()()}if(2&r){const n=e.XpG();e.R7$(6),e.R50("ngModel",n.code)}}function j(r,u){1&r&&(e.j41(0,"p"),e.EFF(1,"El correo es obligatorio."),e.k0s())}function E(r,u){1&r&&(e.j41(0,"p"),e.EFF(1,"Formato de correo inv\xe1lido."),e.k0s())}function w(r,u){if(1&r&&(e.j41(0,"div",31),e.DNE(1,j,2,0,"p",2)(2,E,2,0,"p",2),e.k0s()),2&r){let n,t;const o=e.XpG(2);e.R7$(),e.Y8G("ngIf",null==(n=o.campo("email"))||null==n.errors?null:n.errors.required),e.R7$(),e.Y8G("ngIf",null==(t=o.campo("email"))||null==t.errors?null:t.errors.email)}}function C(r,u){if(1&r){const n=e.RV6();e.j41(0,"div")(1,"h2"),e.EFF(2,"Recuperar Contrase\xf1a"),e.k0s(),e.j41(3,"form",26),e.bIt("ngSubmit",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.requestPassword())}),e.j41(4,"ion-label",27),e.EFF(5,"Correo Electr\xf3nico"),e.k0s(),e.nrm(6,"ion-input",28),e.DNE(7,w,3,2,"div",29),e.j41(8,"ion-button",30),e.EFF(9," Enviar Correo de Recuperaci\xf3n "),e.k0s()()()}if(2&r){let n,t;const o=e.XpG();e.R7$(3),e.Y8G("formGroup",o.restoreForm),e.R7$(4),e.Y8G("ngIf",o.campoTocado("email")&&(null==(n=o.campo("email"))?null:n.invalid)),e.R7$(),e.Y8G("disabled",null==(t=o.restoreForm.get("email"))?null:t.invalid)}}function L(r,u){1&r&&(e.j41(0,"div",21),e.EFF(1," El RUT es obligatorio. "),e.k0s())}function R(r,u){1&r&&(e.j41(0,"div",21),e.EFF(1," El DV es obligatorio. "),e.k0s())}function G(r,u){1&r&&(e.j41(0,"div",21),e.EFF(1," El correo es obligatorio y debe ser v\xe1lido. "),e.k0s())}function I(r,u){1&r&&(e.j41(0,"div",21),e.EFF(1," La contrase\xf1a es obligatoria y debe tener al menos 8 caracteres. "),e.k0s())}function T(r,u){1&r&&(e.j41(0,"div",21),e.EFF(1," El nombre es obligatorio y debe contener solo letras. "),e.k0s())}function M(r,u){1&r&&(e.j41(0,"div",21),e.EFF(1," El apellido es obligatorio y debe contener solo letras. "),e.k0s())}function N(r,u){if(1&r){const n=e.RV6();e.j41(0,"div")(1,"form",9),e.bIt("ngSubmit",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.onRegister())}),e.j41(2,"h2",32),e.EFF(3,"Reg\xedstrate aqu\xed"),e.k0s(),e.j41(4,"div",11)(5,"label",12),e.EFF(6,"RUT"),e.k0s(),e.j41(7,"div",33)(8,"div",34),e.nrm(9,"ion-input",35),e.k0s(),e.j41(10,"div",36),e.nrm(11,"ion-input",37),e.k0s()(),e.DNE(12,L,2,0,"div",14)(13,R,2,0,"div",14),e.k0s(),e.j41(14,"div",11)(15,"label",12),e.EFF(16,"Correo Electr\xf3nico"),e.k0s(),e.nrm(17,"ion-input",38),e.DNE(18,G,2,0,"div",14),e.k0s(),e.j41(19,"div",11)(20,"label",12),e.EFF(21,"Contrase\xf1a"),e.k0s(),e.j41(22,"ion-input",39)(23,"ion-icon",16),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.togglePasswordVisibility("register"))}),e.k0s()(),e.DNE(24,I,2,0,"div",14),e.k0s(),e.j41(25,"div",11)(26,"label",12),e.EFF(27,"Nombre"),e.k0s(),e.nrm(28,"ion-input",40),e.DNE(29,T,2,0,"div",14),e.k0s(),e.j41(30,"div",11)(31,"label",12),e.EFF(32,"Apellido"),e.k0s(),e.nrm(33,"ion-input",41),e.DNE(34,M,2,0,"div",14),e.k0s(),e.j41(35,"ion-button",17),e.EFF(36,"Registrar Proveedor"),e.k0s(),e.j41(37,"div",18)(38,"span",19),e.EFF(39,"\xbfYa tienes cuenta?"),e.k0s(),e.j41(40,"ion-button",20),e.bIt("click",function(){e.eBV(n);const o=e.XpG();return e.Njj(o.handleButtonClick())}),e.EFF(41,"Inicia sesi\xf3n aqu\xed"),e.k0s()()()()}if(2&r){let n,t,o,i,c,a;const l=e.XpG();e.R7$(),e.Y8G("formGroup",l.registerForm),e.R7$(11),e.Y8G("ngIf",(null==(n=l.registerForm.get("rut"))?null:n.invalid)&&(null==(n=l.registerForm.get("rut"))?null:n.touched)),e.R7$(),e.Y8G("ngIf",(null==(t=l.registerForm.get("dv"))?null:t.invalid)&&(null==(t=l.registerForm.get("dv"))?null:t.touched)),e.R7$(5),e.Y8G("ngIf",(null==(o=l.registerForm.get("correo_electronico"))?null:o.invalid)&&(null==(o=l.registerForm.get("correo_electronico"))?null:o.touched)),e.R7$(4),e.Y8G("type",l.showPasswordRegister?"text":"password"),e.R7$(),e.Y8G("name",l.showPasswordRegister?"eye-off":"eye"),e.R7$(),e.Y8G("ngIf",(null==(i=l.registerForm.get("contrasena"))?null:i.invalid)&&(null==(i=l.registerForm.get("contrasena"))?null:i.touched)),e.R7$(5),e.Y8G("ngIf",(null==(c=l.registerForm.get("nom_user"))?null:c.invalid)&&(null==(c=l.registerForm.get("nom_user"))?null:c.touched)),e.R7$(5),e.Y8G("ngIf",(null==(a=l.registerForm.get("ap_user"))?null:a.invalid)&&(null==(a=l.registerForm.get("ap_user"))?null:a.touched))}}const $=[{path:"",component:(()=>{var r;class u{handleButtonClick(){this.toggleCrudForm(),this.toggleLoginForm()}togglePasswordVisibility(t){"login"===t?this.showPasswordLogin=!this.showPasswordLogin:"register"===t&&(this.showPasswordRegister=!this.showPasswordRegister)}constructor(t,o,i,c,a){this.router=t,this.authservice=o,this.proveedorService=i,this.formBuilder=c,this.toast=a,this.username="",this.password="",this.proveedores=[],this.item={rut:"",dv:"",correo_electronico:"",contrasena:"",nom_user:"",ap_user:""},this.showCrudForm=!0,this.showLoginForm=!1,this.showPasswordLogin=!1,this.showPasswordRegister=!1,this.requires2FA=!1,this.restorePassword=!1,this.recuperacion=!1,this.code="",this.loginForm=this.formBuilder.group({username:["",[s.k0.required]],password:["",[s.k0.required,s.k0.minLength(8),s.k0.maxLength(12)]]}),this.registerForm=this.formBuilder.group({rut:["",[s.k0.required,s.k0.pattern("^[0-9]+$"),s.k0.minLength(7),s.k0.maxLength(8)]],dv:["",[s.k0.required,s.k0.pattern("^[0-9Kk]{1}$")]],correo_electronico:["",[s.k0.required,s.k0.email]],contrasena:["",[s.k0.required,s.k0.minLength(8)]],nom_user:["",[s.k0.required,s.k0.pattern("^[a-zA-Z\xf1\xd1]+$")]],ap_user:["",[s.k0.required,s.k0.pattern("^[a-zA-Z\xf1\xd1]+$")]]}),this.restoreForm=this.formBuilder.group({email:["",[s.k0.required]]}),this.tokenForm=this.formBuilder.group({token:[""],contrasena:[""]})}ngOnInit(){}campo(t){return this.loginForm.get(t)}campoTocado(t){var o;return null===(o=this.loginForm.get(t))||void 0===o?void 0:o.touched}toggleLoginForm(){this.showLoginForm=!this.showLoginForm,this.showLoginForm||(this.loginForm.reset(),this.loginForm.updateValueAndValidity())}onVerify2FA(){var t=this;this.authservice.verify2FA(this.username,this.code).subscribe(function(){var o=(0,d.A)(function*(i){console.log("Verificaci\xf3n 2FA exitosa:",i);const c=i.token,a=i.user.rol,l={rol:a};localStorage.setItem("rol",a),localStorage.setItem("authToken",c),localStorage.setItem("user_data",JSON.stringify(l)),t.router.navigate("admin"===a?["/panel-administrador"]:"proveedor"===a?["/panel-proveedor"]:["/home"]),t.requires2FA=!1,(yield t.toast.create({message:"Bienvenido!",position:"top",duration:2e3})).present()});return function(i){return o.apply(this,arguments)}}(),function(){var o=(0,d.A)(function*(i){console.error("Error al verificar 2FA:",i),(yield t.toast.create({message:"Error al verificar el c\xf3digo 2FA",position:"top",duration:2e3})).present()});return function(i){return o.apply(this,arguments)}}())}login(){var t=this;return(0,d.A)(function*(){if(t.loginForm.invalid)return void(yield t.toast.create({message:"Rellene los campos",position:"top",duration:2e3})).present();const{username:o,password:i}=t.loginForm.value;t.authservice.login(o,i).subscribe(function(){var c=(0,d.A)(function*(a){if(a.requires_2fa)t.requires2FA=!0,console.log(t.requires2FA),t.username=o,(yield t.toast.create({message:"C\xf3digo enviado a tu correo",position:"top",duration:2e3})).present();else if(a.token){console.log(t.requires2FA);const l=a.token,g=a.user.rol,_={rol:g};localStorage.setItem("rol",g),localStorage.setItem("authToken",l),localStorage.setItem("user_data",JSON.stringify(_)),yield(yield t.toast.create({header:"Bienvenido Usuario",position:"top",duration:2e3})).present(),t.router.navigate("admin"===g?["/panel-administrador"]:"proveedor"===g?["/panel-proveedor"]:["/home"]),t.loginForm.reset(),t.loginForm.updateValueAndValidity()}});return function(a){return c.apply(this,arguments)}}(),function(){var c=(0,d.A)(function*(a){console.error("Error en el login",a),(yield t.toast.create({message:"Error en el inicio de sesi\xf3n",position:"top",duration:2e3})).present()});return function(a){return c.apply(this,arguments)}}())})()}toggleCrudForm(){this.showCrudForm=!this.showCrudForm,this.showCrudForm||(this.registerForm.reset(),this.registerForm.updateValueAndValidity())}onRegister(){var t=this;return(0,d.A)(function*(){var o;t.registerForm.invalid?(yield t.toast.create({message:"Rellene los campos",position:"top",duration:2e3})).present():t.authservice.registerProveedor(t.registerForm.value).subscribe({next:(o=(0,d.A)(function*(i){console.log("Proveedor registrado exitosamente",i),t.registerForm.reset(),t.registerForm.updateValueAndValidity(),(yield t.toast.create({message:"Proveedor registrado correctamente",position:"top",duration:2e3})).present()}),function(c){return o.apply(this,arguments)}),error:function(){var o=(0,d.A)(function*(i){console.error("Error al registrar proveedor",i),(yield t.toast.create({message:"Error al registrar el proveedor. Intente nuevamente.",position:"top",duration:2e3})).present()});return function(c){return o.apply(this,arguments)}}()})})()}restore(){this.restorePassword=!0,this.showLoginForm=!1}requestPassword(){var t,o=this;const i=null===(t=this.restoreForm.get("email"))||void 0===t?void 0:t.value;i?this.authservice.requestPassword(i).subscribe(function(){var c=(0,d.A)(function*(a){o.recuperacion=!0,console.log("Solicitud de restablecimiento enviada:",a),(yield o.toast.create({message:"Correo de restablecimiento enviado correctamente.",position:"top",duration:2e3})).present(),setTimeout(()=>{window.location.reload()},2e3)});return function(a){return c.apply(this,arguments)}}(),function(){var c=(0,d.A)(function*(a){console.error("Error al solicitar el restablecimiento:",a),(yield o.toast.create({message:"Error al enviar el correo de restablecimiento.",position:"top",duration:2e3})).present()});return function(a){return c.apply(this,arguments)}}()):this.toast.create({message:"Por favor, ingresa tu correo electr\xf3nico.",position:"top",duration:2e3}).then(c=>c.present())}onUpdatePassword(){var t,o,i=this;const c=null===(t=this.tokenForm.get("token"))||void 0===t?void 0:t.value,a=null===(o=this.tokenForm.get("contrasena"))||void 0===o?void 0:o.value;c&&a?this.authservice.updatePassword(c,a).subscribe(function(){var l=(0,d.A)(function*(g){console.log("Contrase\xf1a actualizada exitosamente:",g),(yield i.toast.create({message:"Contrase\xf1a actualizada con \xe9xito.",position:"top",duration:2e3})).present(),i.router.navigate(["/login"])});return function(g){return l.apply(this,arguments)}}(),function(){var l=(0,d.A)(function*(g){console.error("Error al actualizar la contrase\xf1a:",g),(yield i.toast.create({message:"Error al actualizar la contrase\xf1a.",position:"top",duration:2e3})).present()});return function(g){return l.apply(this,arguments)}}()):this.toast.create({message:"Por favor, completa todos los campos.",position:"top",duration:2e3}).then(l=>l.present())}}return(r=u).\u0275fac=function(t){return new(t||r)(e.rXU(f.Ix),e.rXU(F.P),e.rXU(b.m),e.rXU(s.ok),e.rXU(p.K_))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-login"]],decls:22,vars:4,consts:[[1,"bigimage"],[1,"container",2,"max-width","500px"],[4,"ngIf"],[1,"footer"],[1,"containerw"],[1,"float-end"],["href","#",1,"back-to-top"],[1,"footer-text"],["href","#"],["novalidate","",3,"ngSubmit","formGroup"],[1,"mb-4","titular","text-center"],[1,"form-group","mb-3"],[1,"label","mb-2"],["formControlName","username","placeholder","Ingrese su usuario o RUT",1,"form-control"],["class","text-danger",4,"ngIf"],["formControlName","password",1,"form-control",3,"type"],["slot","end",2,"cursor","pointer",3,"click","name"],["color","a","type","submit","expand","block"],[1,"text-center","mt-3"],[2,"color","black","font-weight","bold"],["color","a",3,"click"],[1,"text-danger"],[3,"ngSubmit"],["for","code"],["type","text","id","code","name","code","required","",3,"ngModelChange","ngModel"],["type","submit"],[3,"ngSubmit","formGroup"],["position","stacked"],["type","email","formControlName","email","placeholder","Ingresa tu correo"],["class","error",4,"ngIf"],["expand","block","type","submit","color","a",3,"disabled"],[1,"error"],[1,"mb-4","titulardo","text-center"],[1,"row"],[1,"col-9"],["type","text","formControlName","rut","placeholder","12345678",1,"form-control"],[1,"col-3"],["type","text","formControlName","dv","placeholder","0",1,"form-control"],["type","email","formControlName","correo_electronico",1,"form-control"],["formControlName","contrasena",1,"form-control",3,"type"],["type","text","formControlName","nom_user",1,"form-control"],["type","text","formControlName","ap_user",1,"form-control"]],template:function(t,o){1&t&&(e.j41(0,"ion-content")(1,"div",0)(2,"div",1),e.DNE(3,P,25,5,"div",2)(4,y,9,1,"div",2)(5,C,10,3,"div",2)(6,N,42,9,"div",2),e.k0s()(),e.j41(7,"footer",3)(8,"div",4)(9,"p",5)(10,"a",6),e.EFF(11,"Volver arriba"),e.k0s()(),e.j41(12,"p",7),e.EFF(13," \xa9 2024 "),e.j41(14,"strong"),e.EFF(15,"GreenMarket"),e.k0s(),e.EFF(16," Portafolio. "),e.j41(17,"a",8),e.EFF(18,"Privacidad"),e.k0s(),e.EFF(19," \xb7 "),e.j41(20,"a",8),e.EFF(21,"T\xe9rminos"),e.k0s()()()()()),2&t&&(e.R7$(3),e.Y8G("ngIf",o.showLoginForm&&!o.requires2FA&&!o.restorePassword),e.R7$(),e.Y8G("ngIf",o.requires2FA),e.R7$(),e.Y8G("ngIf",o.restorePassword),e.R7$(),e.Y8G("ngIf",!o.showLoginForm&&!o.requires2FA&&!o.restorePassword))},dependencies:[h.bT,s.qT,s.me,s.BC,s.cb,s.YS,s.vS,s.cV,p.Jm,p.W9,p.iq,p.$w,p.he,p.Gw,s.j4,s.JD],styles:['@charset "UTF-8";.container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background:#72bf78;border-radius:20px;height:780px;width:100%}.bigimage[_ngcontent-%COMP%]{width:100%;min-height:100vh;background:#f5f5f5;background-repeat:repeat;background-position:center center;background-size:cover;background-attachment:scroll;top:0;left:0}.btn[_ngcontent-%COMP%]{color:#000;background:#a0d683;background-color:#a0d683}ion-button[_ngcontent-%COMP%]{color:#000;font-weight:700;background:#a0d683;background-color:#feff9f}.titular[_ngcontent-%COMP%]{background-color:#a0d683;color:#000;width:320px;height:60px;display:flex;justify-content:center;align-items:center;font-weight:700;text-align:center;position:relative;font-family:Bebas Neue,sans-serif;top:10px;font-size:40px;box-shadow:0 10px 10px #0000001a}.titulardo[_ngcontent-%COMP%]{background-color:#a0d683;color:#000;width:320px;height:60px;display:flex;justify-content:center;align-items:center;font-weight:700;position:relative;font-family:Bebas Neue,sans-serif;top:10px;font-size:40px;box-shadow:0 10px 10px #0000001a}.ajustar[_ngcontent-%COMP%]{text-align:center;display:flex;justify-content:center;align-items:center}.centrar[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.btn-link[_ngcontent-%COMP%]{background-color:#ff9}.label[_ngcontent-%COMP%]{align-self:flex-start;color:#000;font-weight:600;font-weight:700;font-size:18px}.form[_ngcontent-%COMP%]   .submit[_ngcontent-%COMP%]{padding:1rem .75rem;width:100%;display:flex;align-items:center;gap:.5rem;border-radius:3rem;background-color:#ff9;color:var(--bg-light);border:none;cursor:pointer;color:#000;font-size:18px;transition:all .3s;font-weight:700;font-size:.9rem}.span[_ngcontent-%COMP%]{text-decoration:none;color:red;opacity:70%}ion-input[_ngcontent-%COMP%]{background-color:#a0d683;font-size:large;font-weight:700;color:#000}.footer[_ngcontent-%COMP%]{background:#72bf78;color:#000;text-align:center;padding:20px 0;box-shadow:0 -4px 10px #0000001a}.footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#feff9f;text-decoration:none;font-weight:700}.footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.footer-text[_ngcontent-%COMP%]{font-size:14px;margin:0}.footer[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#a0d683}.back-to-top[_ngcontent-%COMP%]{background-color:#a0d683;color:#000;padding:8px 12px;border-radius:5px;font-size:12px;font-weight:700;text-decoration:none;transition:all .3s}.back-to-top[_ngcontent-%COMP%]:hover{background-color:#feff9f;color:#000}']}),u})()}];let A=(()=>{var r;class u{}return(r=u).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[f.iI.forChild($),f.iI]}),u})(),V=(()=>{var r;class u{}return(r=u).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[h.MD,s.YN,p.bv,A,s.X1]}),u})()}}]);
"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2503],{2503:(R,p,l)=>{l.r(p),l.d(p,{CarritoPageModule:()=>T});var _=l(177),s=l(4341),a=l(4742),u=l(6766),h=l(467),f=l(5964),t=l(3953),x=l(9368);const C=()=>["/catalogo-producto"];function b(n,c){if(1&n){const r=t.RV6();t.j41(0,"ion-item",19)(1,"ion-label",20),t.EFF(2),t.k0s(),t.j41(3,"ion-label",21),t.EFF(4),t.k0s(),t.j41(5,"div",22)(6,"ion-button",23),t.bIt("click",function(){const e=t.eBV(r).$implicit,i=t.XpG(2);return t.Njj(i.bajarItem(e.producto_id))}),t.EFF(7,"-"),t.k0s(),t.j41(8,"p"),t.EFF(9),t.k0s(),t.j41(10,"ion-button",23),t.bIt("click",function(){const e=t.eBV(r).$implicit,i=t.XpG(2);return t.Njj(i.agregarItem(e.producto_id))}),t.EFF(11,"+"),t.k0s()(),t.j41(12,"ion-label",8),t.EFF(13),t.k0s(),t.j41(14,"ion-button",24),t.bIt("click",function(){const e=t.eBV(r).$implicit,i=t.XpG(2);return t.Njj(i.removeItem(e.producto_id))}),t.nrm(15,"ion-icon",25),t.k0s()()}if(2&n){const r=c.$implicit,o=t.XpG(2);t.R7$(2),t.SpI(" ",r.nombre," "),t.R7$(2),t.SpI(" $",r.precio," CLP$ "),t.R7$(5),t.SpI(" ",r.cantidad," "),t.R7$(4),t.SpI(" $",o.precioUnitario(r.precio,r.cantidad)," CLP ")}}function v(n,c){if(1&n&&(t.j41(0,"ion-list",17),t.DNE(1,b,16,4,"ion-item",18),t.k0s()),2&n){const r=t.XpG();t.R7$(),t.Y8G("ngForOf",r.carrito.items)}}function P(n,c){1&n&&(t.j41(0,"ion-text",41),t.EFF(1," Por favor, ingresa un RUT v\xe1lido. "),t.k0s())}function j(n,c){1&n&&(t.j41(0,"ion-text",41),t.EFF(1," Por favor, ingresa un d\xedgito verificador v\xe1lido. "),t.k0s())}function M(n,c){1&n&&(t.j41(0,"ion-text",41),t.EFF(1," Por favor, ingresa un correo electr\xf3nico v\xe1lido. "),t.k0s())}function k(n,c){1&n&&(t.j41(0,"ion-text",41),t.EFF(1," Por favor, ingresa un nombre. "),t.k0s())}function F(n,c){1&n&&(t.j41(0,"ion-text",41),t.EFF(1," Por favor, ingresa una direcci\xf3n. "),t.k0s())}function E(n,c){if(1&n){const r=t.RV6();t.j41(0,"div")(1,"ion-col",5)(2,"div",6),t.EFF(3," Formulario de datos "),t.k0s()(),t.j41(4,"ion-card",26)(5,"ion-card-content")(6,"form",27),t.nrm(7,"div",28),t.j41(8,"ion-row",29)(9,"ion-col",30)(10,"ion-label",31),t.EFF(11,"RUT"),t.k0s(),t.j41(12,"ion-input",32),t.mxI("ngModelChange",function(e){t.eBV(r);const i=t.XpG();return t.DH7(i.customer.rut,e)||(i.customer.rut=e),t.Njj(e)}),t.bIt("ionBlur",function(){t.eBV(r);const e=t.XpG();return t.Njj(e.buscar_cliente(e.customer.rut))})("ngModelChange",function(){t.eBV(r);const e=t.XpG();return t.Njj(e.validateRut(e.customer.rut))}),t.k0s(),t.DNE(13,P,2,0,"ion-text",33),t.k0s(),t.j41(14,"ion-col")(15,"ion-label",31),t.EFF(16,"DV"),t.k0s(),t.j41(17,"ion-input",34),t.mxI("ngModelChange",function(e){t.eBV(r);const i=t.XpG();return t.DH7(i.customer.dv,e)||(i.customer.dv=e),t.Njj(e)}),t.bIt("ngModelChange",function(){t.eBV(r);const e=t.XpG();return t.Njj(e.validateDV(e.customer.dv))}),t.k0s(),t.DNE(18,j,2,0,"ion-text",33),t.k0s()(),t.j41(19,"ion-row",29)(20,"ion-col")(21,"ion-label",31),t.EFF(22,"Correo Electr\xf3nico"),t.k0s(),t.j41(23,"ion-input",35),t.mxI("ngModelChange",function(e){t.eBV(r);const i=t.XpG();return t.DH7(i.customer.correo_electronico,e)||(i.customer.correo_electronico=e),t.Njj(e)}),t.bIt("ngModelChange",function(){t.eBV(r);const e=t.XpG();return t.Njj(e.validateEmail(e.customer.correo_electronico))}),t.k0s(),t.DNE(24,M,2,0,"ion-text",33),t.k0s(),t.j41(25,"ion-col")(26,"ion-label",31),t.EFF(27,"Nombre"),t.k0s(),t.j41(28,"ion-input",36),t.mxI("ngModelChange",function(e){t.eBV(r);const i=t.XpG();return t.DH7(i.customer.nombre,e)||(i.customer.nombre=e),t.Njj(e)}),t.bIt("ngModelChange",function(){t.eBV(r);const e=t.XpG();return t.Njj(e.validateName(e.customer.nombre))}),t.k0s(),t.DNE(29,k,2,0,"ion-text",33),t.k0s(),t.j41(30,"ion-col")(31,"ion-label",31),t.EFF(32,"Direcci\xf3n"),t.k0s(),t.j41(33,"ion-input",37),t.mxI("ngModelChange",function(e){t.eBV(r);const i=t.XpG();return t.DH7(i.customer.direccion,e)||(i.customer.direccion=e),t.Njj(e)}),t.bIt("ngModelChange",function(){t.eBV(r);const e=t.XpG();return t.Njj(e.validateAddress(e.customer.direccion))}),t.k0s(),t.DNE(34,F,2,0,"ion-text",33),t.k0s()(),t.j41(35,"div",38)(36,"input",39),t.mxI("ngModelChange",function(e){t.eBV(r);const i=t.XpG();return t.DH7(i.guardarCliente,e)||(i.guardarCliente=e),t.Njj(e)}),t.k0s(),t.EFF(37," \xbfQuiere guardar sus datos? "),t.k0s(),t.j41(38,"div",38)(39,"ion-button",40),t.bIt("click",function(){t.eBV(r);const e=t.XpG();return t.Njj(e.checkout_pago())}),t.EFF(40,"Pagar"),t.k0s()()()()()()}if(2&n){const r=t.XpG();t.R7$(12),t.R50("ngModel",r.customer.rut),t.R7$(),t.Y8G("ngIf",!r.validateRut(r.customer.rut)&&r.customer.rut),t.R7$(4),t.R50("ngModel",r.customer.dv),t.R7$(),t.Y8G("ngIf",!r.validateDV(r.customer.dv)&&r.customer.dv),t.R7$(5),t.R50("ngModel",r.customer.correo_electronico),t.R7$(),t.Y8G("ngIf",!r.validateEmail(r.customer.correo_electronico)&&r.customer.correo_electronico),t.R7$(4),t.R50("ngModel",r.customer.nombre),t.R7$(),t.Y8G("ngIf",!r.validateName(r.customer.nombre)&&r.customer.nombre),t.R7$(4),t.R50("ngModel",r.customer.direccion),t.R7$(),t.Y8G("ngIf",!r.validateAddress(r.customer.direccion)&&r.customer.direccion),t.R7$(2),t.R50("ngModel",r.guardarCliente)}}function w(n,c){1&n&&(t.j41(0,"ion-item",42)(1,"ion-label"),t.EFF(2,"El carrito est\xe1 vac\xedo"),t.k0s()())}const I=[{path:"",component:(()=>{var n;class c{constructor(o,e,i){this.cartService=o,this.toastController=e,this.router=i,this.cartItems=[],this.total=0,this.customer={rut:"",dv:"",correo_electronico:"",nombre:"",direccion:""},this.mensaje="",this.showClienteForm=!1,this.guardarCliente=!1}ngOnInit(){this.loadCart(),this.loadCustomerData(),this.router.events.pipe((0,f.p)(o=>o instanceof u.wF)).subscribe(()=>{this.loadCart()})}toggleClienteForm(){this.showClienteForm&&this.resetClienteForm(),this.showClienteForm=!this.showClienteForm}resetClienteForm(){this.customer={rut:"",dv:"",correo_electronico:"",nombre:"",direccion:""},this.guardarCliente=!1}precioUnitario(o,e){return o*e}loadCart(){this.cartService.ver_carrito().subscribe(o=>{this.carrito=o,this.cartItems=o.items,this.total=Number(o.total),console.log("Carrito cargado:",this.carrito),console.log("Items del carrito:",this.cartItems),console.log("Total del carrito:",this.total)},o=>{console.error("Error al cargar el carrito:",o)})}loadCustomerData(){const o=localStorage.getItem("customerData");o&&(this.customer=JSON.parse(o))}removeItem(o){this.cartService.eliminar_carrito(o).subscribe(()=>{this.loadCart()})}agregarItem(o){this.cartService.agregar_Carrito(o).subscribe(()=>{this.loadCart()})}bajarItem(o){this.cartService.restar_carrito(o).subscribe(()=>{this.loadCart()})}calcularTotalCarrito(){let o=0;return this.carrito&&Array.isArray(this.carrito.items)?this.carrito.items.forEach(e=>{o+=e.precio*e.cantidad}):console.error("El carrito no tiene items v\xe1lidos:",this.carrito),o}mostrarToast(o){var e=this;return(0,h.A)(function*(){yield(yield e.toastController.create({message:o,duration:3e3,position:"top",color:"dark"})).present()})()}buscar_cliente(o){o&&this.cartService.obtener_cliente(o).subscribe(e=>{e&&(this.customer.dv=e.dv,this.customer.correo_electronico=e.correo_electronico,this.customer.nombre=e.nombre,this.customer.direccion=e.direccion)})}guardarClienteSiEsSeleccionado(){this.guardarCliente&&this.cartService.crearCliente(this.customer).subscribe(o=>{console.log("Cliente creado exitosamente",o)},o=>{console.error("Error al guardar el cliente",o)})}validateRut(o){return/^\d{7,8}$/.test(o)}validateDV(o){return 1===o.length&&/^[0-9kK]$/.test(o)}validateEmail(o){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)}validateName(o){return o.trim().length>0}validateAddress(o){return o.trim().length>0}validateForm(){return this.validateRut(this.customer.rut)?this.validateDV(this.customer.dv)?this.validateEmail(this.customer.correo_electronico)?this.validateName(this.customer.nombre)?!!this.validateAddress(this.customer.direccion)||(this.mostrarToast("Por favor, ingresa una direcci\xf3n."),!1):(this.mostrarToast("Por favor, ingresa un nombre."),!1):(this.mostrarToast("Por favor, ingresa un correo electr\xf3nico v\xe1lido."),!1):(this.mostrarToast("Por favor, ingresa un d\xedgito verificador v\xe1lido."),!1):(this.mostrarToast("Por favor, ingresa un RUT v\xe1lido."),!1)}checkout_pago(){if(0===this.cartItems.length)return void this.mostrarToast("El carrito est\xe1 vac\xedo. Agrega productos antes de proceder al pago.");if(!this.validateForm())return void this.mostrarToast("Completa el formulario antes de seguir");const o=this.cartItems.map(i=>({producto_id:i.producto_id,cantidad:i.cantidad}));this.cartService.checkout({customer:this.customer.rut,items:o,total:this.total}).subscribe(i=>{i&&i.orden_id?(this.mostrarToast(`Orden creada. ID de la orden: ${i.orden_id}`),this.cartService.iniciarPago({total:this.total}).subscribe(d=>{if(console.log(d),d.success){const g=document.createElement("form");g.method="POST",g.action=d.transaction_url;const m=document.createElement("input");m.type="hidden",m.name="token_ws",m.value=d.token,g.appendChild(m),document.body.appendChild(g),g.submit()}else this.mostrarToast("Error al iniciar pago: "+d.message)},d=>{console.error(d),this.mostrarToast("Ocurri\xf3 un error al iniciar el pago.")})):this.mostrarToast("Error: No se recibi\xf3 el ID de la orden.")},i=>{console.error("Error al crear la orden",i),this.mostrarToast("Error al crear la orden. Int\xe9ntalo de nuevo.")})}}return(n=c).\u0275fac=function(o){return new(o||n)(t.rXU(x.D),t.rXU(a.K_),t.rXU(u.Ix))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-carrito"]],decls:47,vars:8,consts:[["noItems",""],[3,"translucent"],["color","A ",1,"colormenus"],[1,"titulo"],[1,"fondo"],[1,"centrar"],[1,"titular"],[1,"header-row","ion-justify-content-center","ion-align-items-center"],[1,"precio"],[1,"ion-justify-content-center","ion-align-items-center"],["size","12","size-md","10","size-lg","8"],["class","listacarro",4,"ngIf","ngIfElse"],[1,"botonespagar"],[1,"bpagar",3,"routerLink"],[1,"total"],[1,"bpagar",3,"click"],[4,"ngIf"],[1,"listacarro"],["color","color2",4,"ngFor","ngForOf"],["color","color2"],["id","nombrep"],[1,"precio-unitario"],[1,"aumentar-disminuir"],[3,"click"],["color","danger",3,"click"],["slot","icon-only","name","trash-outline"],[1,"tarjeta"],[1,"form"],[1,"cuadrado"],[1,"rutcompleto"],["size","9"],["position","stacked",1,"label"],["name","rut","placeholder","RUT",1,"formulario",3,"ngModelChange","ionBlur","ngModel"],["color","danger",4,"ngIf"],["type","text","name","dv","placeholder","DV",1,"dv-input",3,"ngModelChange","ngModel"],["type","email","name","correo_electronico","placeholder","CORREO",1,"formulario",3,"ngModelChange","ngModel"],["type","text","name","nombre","placeholder","NOMBRE",1,"formulario",3,"ngModelChange","ngModel"],["type","text","name","direccion","placeholder","DIRECCI\xd3N",1,"formulario",3,"ngModelChange","ngModel"],[1,"button-center"],["type","checkbox",3,"ngModelChange","ngModel"],[1,"submit",3,"click"],["color","danger"],["color","1",1,"carritovacio"]],template:function(o,e){if(1&o){const i=t.RV6();t.j41(0,"ion-header",1)(1,"ion-toolbar",2)(2,"ion-title",3),t.EFF(3,"GreenMarket"),t.k0s()()(),t.j41(4,"ion-content")(5,"ion-grid",4)(6,"ion-row")(7,"ion-col",5)(8,"div",6),t.EFF(9," Tu carrito de compras "),t.k0s()()(),t.j41(10,"ion-row")(11,"ion-col")(12,"ion-row",7)(13,"ion-col")(14,"ion-label"),t.EFF(15,"PRODUCTO"),t.k0s()(),t.j41(16,"ion-col")(17,"ion-label"),t.EFF(18,"PRECIO"),t.k0s()(),t.j41(19,"ion-col")(20,"ion-label"),t.EFF(21,"CANTIDAD"),t.k0s()(),t.j41(22,"ion-col")(23,"ion-label",8),t.EFF(24,"SUBTOTAL"),t.k0s()()(),t.j41(25,"ion-row",9)(26,"ion-col",10),t.DNE(27,v,2,1,"ion-list",11),t.k0s()()()(),t.j41(28,"ion-row",12)(29,"ion-col")(30,"ion-label")(31,"div",13),t.EFF(32," Seguir comprando "),t.k0s()()(),t.j41(33,"ion-col",14)(34,"ion-label"),t.EFF(35,"Total: "),t.nrm(36,"br"),t.EFF(37),t.k0s()(),t.j41(38,"ion-col")(39,"ion-label")(40,"div",15),t.bIt("click",function(){return t.eBV(i),t.Njj(e.toggleClienteForm())}),t.EFF(41),t.k0s()()()(),t.j41(42,"ion-row")(43,"ion-col"),t.DNE(44,E,41,11,"div",16),t.k0s()()()(),t.DNE(45,w,3,0,"ng-template",null,0,t.C5r)}if(2&o){const i=t.sdS(46);t.Y8G("translucent",!0),t.R7$(27),t.Y8G("ngIf",e.carrito&&e.carrito.items.length>0)("ngIfElse",i),t.R7$(4),t.Y8G("routerLink",t.lJ4(7,C)),t.R7$(6),t.SpI("$",e.total,""),t.R7$(4),t.SpI(" ",e.showClienteForm?"Cancelar":"Continuar"," "),t.R7$(3),t.Y8G("ngIf",e.showClienteForm)}},dependencies:[_.Sq,_.bT,s.qT,s.Zm,s.BC,s.cb,s.vS,s.cV,a.Jm,a.b_,a.I9,a.hU,a.W9,a.lO,a.eU,a.iq,a.$w,a.uz,a.he,a.nf,a.ln,a.IO,a.BC,a.ai,a.Gw,a.N7,u.Wk],styles:['@charset "UTF-8";ion-toolbar[_ngcontent-%COMP%]{position:relative}ion-button[_ngcontent-%COMP%]{--background: yellow;--color: black;padding:4px}button-div[_ngcontent-%COMP%]{cursor:pointer;background-color:#e7f456f7;color:#000;padding:10px 20px;font-size:20px;font-weight:700;border-radius:5px;text-align:center;transition:background-color .3s}.button-div[_ngcontent-%COMP%]:hover{background-color:#0056b3}.card[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.total[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;text-align:center;font-weight:700}.tarjeta[_ngcontent-%COMP%]{background-color:#72bf78;border-radius:20px;box-shadow:0 10px 10px #0000001a;max-width:928px;padding:10px 15px;margin:0 auto}.formulario[_ngcontent-%COMP%]{color:#000;font-weight:700;font-size:18px;background-color:#a0d683;padding:10px;max-width:500px;min-width:300px}.ajustar[_ngcontent-%COMP%]{text-align:center;display:flex;justify-content:center;align-items:center}.centrar[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.titular[_ngcontent-%COMP%]{background-color:#a0d683;color:#000;width:320px;height:60px;display:flex;justify-content:center;align-items:center;font-weight:700;text-align:center;font-family:Bebas Neue,sans-serif;font-size:40px;box-shadow:0 10px 10px #0000001a}.fondo[_ngcontent-%COMP%]{width:100%;min-height:100vh;background:#f5f5f5}.colormenus[_ngcontent-%COMP%]{background:#72bf78;color:#000}.titulo[_ngcontent-%COMP%]{font-weight:700;text-align:center}.header-row[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:700;text-align:center}.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{text-align:center;padding:10px;border-right:2px solid rgb(0,0,0)}.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]:last-child{border-right:none}.bpagar[_ngcontent-%COMP%]{background-color:#feff9f;color:#000;font-weight:700;border-radius:8px;padding:10px 0;box-shadow:0 4px 6px #0000001a;transition:background-color .3s ease;display:flex;justify-content:center;align-items:center;text-align:center}.botonespagar[_ngcontent-%COMP%]{background:#72bf78;color:#000;font-weight:700;display:flex;justify-content:space-between;align-items:center;text-align:center;max-width:928px;padding:10px 15px;margin:0 auto;border-bottom-left-radius:20px;border-bottom-right-radius:20px}.header-row[_ngcontent-%COMP%]{background:#72bf78;color:#000;font-weight:700;display:flex;justify-content:space-between;align-items:center;text-align:center;max-width:928px;padding:10px 15px;border-top-left-radius:20px;border-top-right-radius:20px;margin:0 auto;box-shadow:0 10px 10px #0000001a}.bpagar[_ngcontent-%COMP%]:hover{background-color:#a0d683}.bpagar[_ngcontent-%COMP%]:active{background-color:#233023}.ion-row[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:0;padding-top:0}.listacarro[_ngcontent-%COMP%]{background-color:#a0d683;width:100%;max-width:1000px;border:#2F4232 2px solid;position:relative;justify-content:center;align-items:center;max-width:928px;padding:10px 15px;border-radius:20px;color:#000;margin:0 auto;box-shadow:0 10px 10px #0000001a}ion-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:10px;width:100%;max-width:1000px}ion-label[_ngcontent-%COMP%]{flex:1;text-align:center}.aumentar-disminuir[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}ion-button[_ngcontent-%COMP%]{--padding-start: 5px;--padding-end: 5px}.label[_ngcontent-%COMP%]{color:#000}.titulo[_ngcontent-%COMP%]{font-weight:700;font-family:Bebas Neue,sans-serif;font-size:50px;color:#000;position:relative;text-align:start;display:flex;justify-content:start;align-items:start}.precio[_ngcontent-%COMP%]{flex:1;position:relative;left:8.9%;text-align:center;color:#000;font-weight:700}.precio-unitario[_ngcontent-%COMP%]{flex:1;position:relative;right:8.3%;text-align:center;color:#000;font-weight:700}#nombrep[_ngcontent-%COMP%]{flex:1;position:relative;right:4%;text-align:center;color:#000;font-weight:700}.color2[_ngcontent-%COMP%]{color:#000}.carritovacio[_ngcontent-%COMP%]{color:#000;background-color:#a0d683;display:flex;align-items:center;text-align:center;font-weight:700;max-width:928px;padding:10px 15px;margin:0 auto;border:rgb(0,0,0) 2px solid;border-radius:10px;box-shadow:0 10px 10px #0000001a}.rutcompleto[_ngcontent-%COMP%]{font-weight:700;font-size:18px;max-width:600px;min-width:300px}.rut-input[_ngcontent-%COMP%]{background-color:#a0d683;color:#000;font-weight:700;font-size:18px;max-width:600px}.dv-input[_ngcontent-%COMP%]{background-color:#a0d683;color:#000;font-weight:700;font-size:18px;width:50px;padding:10px;max-width:600px}']}),c})()}];let O=(()=>{var n;class c{}return(n=c).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[u.iI.forChild(I),u.iI]}),c})(),T=(()=>{var n;class c{}return(n=c).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[_.MD,s.YN,a.bv,O,s.X1]}),c})()}}]);